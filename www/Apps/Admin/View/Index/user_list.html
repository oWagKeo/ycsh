<div class="am-g" style="margin-bottom: 10px">
    <div class="am-u-sm-12" style="text-align: center">
        <form class="am-form am-form-inline" action="__URL__/user_list" method="get">
            <div class="" style="width: 100%;padding-top: 5px"></div>
            <div class="am-form-group">
                <input type="text" name="user" value="{$search.user}" placeholder="用户名" style="width: 150px;">
            </div>
            <div class="am-form-group">
                <input type="text" name="phone" value="{$search.phone}" placeholder="电话" style="width: 150px;">
            </div>
           <!-- <div class="am-form-group">
                <select name="reg" id="reg">
                    <option value="all">所有用户</option>
                    <option value="1">注册用户</option>
                    <option value="2">未注册用户</option>
                </select>
            </div>-->
            <div class="am-form-group">
                <input class="am-btn am-btn-primary am-radius am-btn-sm" type="submit" value="搜索">
            </div>
        </form>
    </div>
</div>
<table class="am-table am-table-bordered am-table-radius am-table-striped am-table-hover am-table-compact">
    <empty name="info">
        <tr><th>暂无数据</th></tr>
    <else />
        <tr><td colspan="9" align="right">共有{$count}条数据</td></tr>
        <tr>
            <th>用户名</th>
            <th>电话</th>
            <th>银行卡</th>
            <th>注册时间</th>
            <th>总积分</th>
            <th>抽奖次数</th>
            <th>积分日志</th>
            <th>编辑</th>
            <th>移除</th>
        </tr>
        <volist name="info" id="vo">
            <tr>
                <td>{$vo.u_name|default="<span style='color: red'>未注册</span>"}</td>
                <td>{$vo.u_phone|default="<span style='color: red'>未注册</span>"}</td>
                <td>{$vo.u_cardno|default="<span style='color: red'>未注册</span>"}</td>
                <td align="center">{$vo.u_create|date='Y-m-d H:i:s',###}</td>
                <td align="center">{$vo.u_score}</td>
                <td align="center">{$vo.u_lottery}</td>
                <td align="center">
                    <a data-name="{$vo.u_name}" data-id="{$vo.u_id}" title="查询积分" name="score" data-am-modal="{target: '#my-alert' }"><span class="am-icon-usd am-icon-sm"></span></a>&nbsp;
                </td>
                <td align="center">
                    <a href="__URL__/user_info/uid/{$vo.u_id}" title="编辑" name="score"><span class="am-icon-edit am-icon-sm"></span></a>&nbsp;
                </td>
                <td align="center">
                    <a data-name="{$vo.u_name}" data-id="{$vo.u_id}" title="移除"  name="remove"><span class="am-icon-trash am-icon-sm "></span></a>&nbsp;
                </td>
            </tr>
        </volist>
        <tr align="center">
            <td colspan="13">{$page}</td>
        </tr>
    </empty>
</table>
<div class="am-modal am-modal-alert" tabindex="-1" id="my-alert">
    <div class="am-modal-dialog">
        <div class="am-modal-hd">用户[]的积分</div>
        <div class="am-modal-bd" style="max-height: 300px; overflow-y: scroll;">
            <div id="loading"><i class="am-icon-spinner am-icon-pulse"></i></div>
            <table class="am-table am-table-bordered am-table-hover am-table-striped am-table-compact" id="user_table" style="display: none">
            </table>
        </div>
        <div class="am-modal-footer">
            <span class="am-modal-btn">确定</span>
        </div>
    </div>
</div>

<div class="am-modal am-modal-confirm" tabindex="-1" id="my-confirm">
    <div class="am-modal-dialog">
        <div class="am-modal-hd">提示信息</div>
        <div class="am-modal-bd">
           确定要删除这条记录吗？
        </div>
        <div class="am-modal-footer">
            <span class="am-modal-btn" data-am-modal-cancel>取消</span>
            <span class="am-modal-btn" data-am-modal-confirm>确定</span>
        </div>
    </div>
</div>

<script>
    $(function () {
        $("#reg option[value = '{$search.reg}']").attr('selected',true);
    })
    $('a[name = "score"]').click(function () {
        $('#user_table').empty();
        $('#loading').show();
        $('#user_table').hide();
        $("#my-alert .am-modal-hd").text('用户['+$(this).attr('data-name')+']的积分');
        $.ajax({
            type:'post',
            url:'__URL__/get_user_score',
            data:{uid:$(this).attr('data-id')},
            success:function (res) {
                var con = '<tr><th colspan="3">总积分:'+res.score+'</th></tr><tr><td colspan="3" align="center">积分日志</td></tr>';
                if(res.log.length == 0){
                    con += '<tr><td colspan="3" align="center">暂无记录</td></tr>';
                }else{
                    con += '<tr><th align="center">时间</th><th>消耗积分</th><th>兑换劵</th></tr>';
                    for(var i = 0;i<res.log.length;i++){
                        con += '<tr><td align="center">'+res.log[i].e_create+'</td><td>'+res.log[i].e_price+'</td><td>'+res.log[i].g_name+'</td></tr>';
                    }
                }
                $('#user_table').append(con);
                $('#loading').hide();
                $('#user_table').show();
            }
        })
    });
    $('a[name = "remove"]').click(function () {
        uid = $(this).attr('data-id');
        p = $(this).parent().parent();
        $("#my-confirm .am-modal-bd").text('确定要移除用户['+$(this).attr('data-name')+']吗？');
        $('#my-confirm').modal({
            onConfirm: function (options) {
                $.ajax({
                    type:'post',
                    url:'__URL__/user_remove',
                    data:{uid:uid},
                    success:function (res) {
                        if(res == 1){
                            p.remove();
                            alert('移除成功');
                        }else{
                            alert('移除失败');
                        }
                    }
                })
            },
        })
    })
</script>